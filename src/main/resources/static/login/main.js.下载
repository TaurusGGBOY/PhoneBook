(function(e){e.extend({tips:function(t){var n={delay:200,tgClass:"",margin:{l:0,r:0,b:0,t:0},offset:!1};e.extend(n,t);var r=e(n.relation),i=n.reMaxWidth,s=n.margin,o=null,u=e("body"),a=null,f=function(t){clearTimeout(o),a=e(t.currentTarget);var i=a.offset(),u,f;switch(n.position){case"r":u=i.left+a.outerWidth()+s.l,f=i.top+s.t;break;case"l":u=i.left-r.outerWidth()+s.l,f=i.top+s.t;break;case"b":u=i.left+s.l,f=i.top+a.outerHeight()+s.t}a.addClass(n.tgClass),r.css({left:u,top:f}).show()},l=function(t){o=setTimeout(function(){a===null&&(a=e(n.handle).filter(":visible")),a.removeClass(n.tgClass),r.hide(),a=null},n.delay)};n.eventType&&u.delegate(n.handle,n.eventType,f),u.delegate(n.handle,"mouseleave",l),r.hover(function(){clearTimeout(o),a===null&&(a=e(n.handle).filter(":visible")),a.addClass(n.tgClass),e(this).show()},function(t){if(e(t.relatedTarget).closest("#"+a.attr("id")).length)return;clearTimeout(o),l()})}})})(jQuery),define("tips",function(){}),define("common",["underscore","backbone","md5","g","tips"],function(e,t,n,r){var i=t.$,s=r.QQ;t.sync=function(t,n,r){var o="",u={myuinmd5:i.md5(s),X_Content_Type:"json"},a=r||{};a.url||(a.url=e.result(n,"url")),(t=="update"||t=="create"||t=="delete")&&i.extend(u,n.attributes),a.data=i.extend(a.data||{},u),a.dataType="json",a.type="POST",i.ajax(a)};var o={resolveResult:function(e,t){switch(e){case"0":return!0;case"-1000":return this.noLogin(),!1;case"-1":return this.ajaxTips(t),!1}return!0},isLogin:function(e){var t=this;i.ajax({url:r.contextPath+"/pim/check_login_json.jsp",success:function(n){n.result=="0"?e():t.noLogin()}})},noLogin:function(){top.location="http://"+location.host+r.contextPath+"/pim/login.jsp"},ajaxTips:function(e){var t=i("#loading");t.text(e).css("left",(i(window).width()-t.width())/2).stop(!0,!0).show(0).delay(1500).fadeOut(500)},openTips:function(){var e=i("#loading");e.text("正在加载...").css("left",(i(window).width()-e.width())/2).show()},closeTips:function(){i("#loading").hide()},encodeStr:function(e,t){var n="";for(var r=0,i=t.length;r<i;r++){var s=t.charCodeAt(r).toString(16);s.length<=2&&(s="00"+s),n+=s}return n="0x"+n,e+"X-CUSTOM"+n},htmlEncode:function(e){return typeof e=="string"?e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""},htmlUnEncode:function(e){return typeof e=="string"?e.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'"):""},getStrLen:function(e){return e.replace(/[^\x00-\xff]/g,"rr").length},getSubStr:function(e,t){var n=PIM.Util.getStrLen(e);if(n<=t)return e;var r=/[^\x00-\xff]/,i="",s="",o=0,u=0;while(u<t)s=e.charAt(o),r.test(s)?u+=2:u++,o++,i+=s;return i+"..."},showModule:function(e){i(e).siblings().hide().end().show()},setDomHeight:function(t){var n=t.callback,r=i(t.selector);if(!r.length||r.is(":hidden"))return;if(n)return n();var s=i(window).height()-r.offset().top;if(t.rel){var o=r.siblings(t.rel);o.length&&o.is(":visible")&&(s-=o.outerHeight())}r.height(s),this.heightManageBox.push(t),e.uniq(this.heightManageBox)},heightManageBox:[],windowResizeHeightManage:function(){i.each(this.heightManageBox,function(e,t){o.setDomHeight(t)})},clone:function(e){function t(){}return t.prototype=e,new t},wrapSearchKey:function(e,t){if(i.trim(t)==="")return e;var n=t.replace(/([\+\[\*\(\)\.\?\\\^{\|])/g,"\\$1"),r=new RegExp(n,"g");return e=e.replace(r,'<b class="s-k">'+t+"</b>"),e},logSubmit:function(e,t){var n=t||i(this).attr("name"),s="screenWH:"+screen.width+"*"+screen.height,o="mouseXY:"+e.pageX+"*"+e.pageY;i.ajax({data:{action:n,screenWH:s,coordinate:o},url:r.contextPath+"/pim/statistic_Analysis/pim_index_action.jsp",global:!1})}};return i(".quit,.icon-quit").on("click",function(e){e.preventDefault(),pt_logout.logout(function(e){e===2||e===1?location.replace(r.contextPath+"/pim/login_out.jsp"):alert("安全退出失败，请重试！")})}),i.ajaxSetup({data:{myuinmd5:i.md5(s),X_Content_Type:"json",csrfToken:r.csrfToken},dataType:"json",type:"POST",cache:!1}),i(document).ajaxStart(o.openTips).ajaxStop(o.closeTips),i("body").delegate(".text",{focus:function(){i(this).addClass("text-focus")},blur:function(){i(this).removeClass("text-focus")}}).delegate("[tool-tips]",{mouseenter:function(){var e=i(this),t=e.outerWidth(),n=i(".tool-tips-box").hide(),r=0,s=e.offset(),u,a,f=e.attr("tool-tips"),l=o.htmlEncode(f).replace(/\n/g,"<br/>");n.length||(n=i("<div/>").addClass("tool-tips-box"),n.html('<div class="txt"></div><div class="a-b"><div class="a"></div></div>'),n.appendTo("body")),n.find(".txt").html(l),r=n.outerWidth(),u=s.left-(r-t)/2,a=s.top+e.outerHeight()+5,u<0&&(u=5),n.css({left:u,top:a}).stop(!0,!0).delay(300).fadeIn(150)},mouseleave:function(){i(".tool-tips-box").stop(!0,!0).delay(300).fadeOut(150)},click:function(){i(".tool-tips-box").stop(!0,!0).hide()}}).delegate(".logClass","click",o.logSubmit),i(window).resize(function(){o.windowResizeHeightManage()}),function(e){var t=/(\w+)\.jsp/.exec(location.pathname);t!=null&&t[1]!=undefined&&e("#menu").find("a[name="+t[1]+"]").addClass("current")}(jQuery),i.tips({handle:"#menuUserAvatar",relation:"#helpLinks",position:"b",offset:!0,margin:{l:10,t:0},eventType:"mouseenter"}),o}),define("router",["underscore","backbone","common"],function(e,t,n){var r=t.Router.extend({routes:{"":"getList","list/:groupId/:pageNo/:pageSize/:order/:sortBy/:key":"getList","recycle/:pageNo/:pageSize/:key":"getRecycleList","edit/:groupId/:dataId(/:isFromEdit)":"edit",add:"add",merge:"merge","export":"_export","import":"_import",batch:"batch",time:"time",chong:"chong","*error":"error"},getList:function(t,n,r,i,s,o){arguments.length===0&&(t="-1",n="1",r="50",i="ASC",s="name",o="0");var u=this,a={groupId:t,pageNo:n,pageSize:r,order:i,sortBy:s,key:o};a.groupId=parseInt(a.groupId),require(["list/p.model","group/view","list/all.view"],function(t,n,r){if(!e.isEqual(a,t.toJSON())){t.set(a);if(!t.legality)return}var i=n.collectionView.collection.get(a.groupId),s=a.key;i===undefined?u.error(a.groupId):(i.clickStatus(),a.key=s==="0"?"":encodeURIComponent(s),r.getData(a))})},getRecycleList:function(t,n,r){var i={pageNo:t,pageSize:n,key:r};require(["recycle/p.model"],function(t){e.isEqual(i,t.toJSON())||t.set(i),require(["group/view","recycle/all.view"],function(e,t){e.selRecycle(),i.key==="0"&&(i.key=""),t.getData(i)})})},edit:function(e,t,r){var i=this;r?require(["edit/view","edit/list"],function(e,n){var r=n.collection,s=r.get(t);if(!s){i.error();return}e.setData(s.toJSON()),n.setData(r.toJSON(),t)}):(n.openTips(),require(["list/collection"],function(e){var r=e.get(t);if(!r){i.error();return}require(["edit/view"],function(i){n.closeTips(),i.setData(r.toJSON()),require(["edit/list"],function(n){n.setData(e.toJSON(),t)})})}))},add:function(){n.openTips(),require(["edit/view","group/collection"],function(e,t){n.closeTips();var r=t.findWhere({selected:!0}),i={dataid:0,now:(new Date).getTime(),taglist:[{groupId:r.get("groupId"),groupName:r.get("groupName")}],vcard:{N:[{VALUE:";;;;"}]}};e.setData(i)})},merge:function(){n.openTips(),require(["merge/view.all"],function(e){n.closeTips(),e.check()})},_import:function(){n.openTips(),require(["import/import"],function(e){n.closeTips(),e.show()})},_export:function(){n.openTips(),require(["export/view","list/p.model","g"],function(e,t,r){n.closeTips();var i={groupId:t.get("groupId"),qq:r.m_c||r.QQ,now:(new Date).getTime(),contextPath:r.contextPath};e.show(i)})},time:function(){n.openTips(),require(["time/view"],function(e){n.closeTips(),e.chk()})},batch:function(){n.openTips(),require(["batch/view"],function(e){n.closeTips(),e.show()})},chong:function(){n.openTips(),require(["chong/view"],function(e){n.closeTips(),e.show()})},error:function(e){this.navigate("list/-1/1/50/ASC/name/0",{trigger:!0})}}),i=new r;return t.history.start(),i}),define("group/model",["backbone"],function(e){var t=e.Model.extend({defaults:{groupName:"all",dataListSize:0,selected:!1,edited:!1,hover:!1},idAttribute:"groupId",parse:function(e){return e.result!==undefined?e.result==="0"?e.info||{}:{result:e.msg}:e},validate:function(e,t){if(e.groupName=="")return"分组名不能为空";if(e.groupName==this.previous("groupName"))return"分组没有任何更改！";if(e.result)return e.result},clickStatus:function(){require("group/view").resetClickStatus(),this.set("selected",!0)},setEdited:function(){var e=require("group/view").collectionView.collection.findWhere({edited:!0});e&&e.set("edited",!1),this.set("edited",!0)}});return t}),define("text!group/model.tmpl.html",[],function(){return'<a class="group-name" href="javascript:void(0)" title="<%-groupName%>">\r\n	<span class="g-n-t" name="gName"><%-groupName%></span>\r\n	<span class="count">[<%=dataListSize%>]</span>\r\n</a>\r\n<span class="group-edit-del">\r\n	<a href="javascript:void(0)" title="编辑分组" class="icons icon-group-edit"></a><a href="javascript:void(0)" title="删除分组" class="icons icon-group-del"></a>\r\n</span>\r\n<span class="edit-label">\r\n	<input type="text" class="edit-text" value="<%-groupName%>" />\r\n</span>\r\n<span class="group-sure-cancel">\r\n	<a class="icons icon-group-sure" title="确认修改" href="javascript:void(0)"></a><a class="icons icon-group-cancel" title="取消编辑" href="javascript:void(0)"></a>\r\n</span>'}),define("group/model.view",["backbone","g","text!group/model.tmpl.html"],function(e,t,n){var r=e.$,i=t.contextPath,s=e.View.extend({tmpl:_.template(n),tmplSys:_.template('<a href="javascript:void(0)" class="group-name"><span class="g-n-t"><%=groupName%></span><span class="count">[<%=dataListSize%>]</span></a>'),tmplAdd:_.template('<label class="edit-label"><input type="text" class="edit-text"></label><span class="group-sure-cancel"><a href="javascript:void(0)" title="确认" class="icons icon-group-sure"></a><a href="javascript:void(0)" title="取消" class="icons icon-group-cancel"></a></span>'),tagName:"li",className:"group-item",attributes:{name:"group_other"},events:{mouseenter:"mouseenter",mouseleave:"mouseleave",click:"click","click .icon-group-edit":"edit","keypress .edit-text":"editOnEnter","click .icon-group-del":"del","click .icon-group-sure":"editSure","click .icon-group-cancel":"editCancel"},initialize:function(){this.listenTo(this.model,"destroy",this.delBack),this.listenTo(this.model,"change:groupName",this.nameChange),this.model.on("remove",this.scrollBarManage),this.listenTo(this.model,"change:selected",this.selected),this.listenTo(this.model,"change:edited",this.edited),this.listenTo(this.model,"change:hover",this.hover),this.listenTo(this.model,"invalid",this.valiErr)},valiErr:function(e,t){var n=this;require(["formtips"],function(){n.editInput.formtips({msg:t})})},scrollBarManage:function(){require("group/view").scrollBarManage()},render:function(){var e=this.model.toJSON();switch(e.groupId){case-1:this.groupAll||(this.groupAll=r("#groupAll").find("li"),this.setElement(this.groupAll)),this.groupAll.html(this.tmplSys(e));break;case 0:this.groupNo||(this.groupNo=r("#groupNo").find("li"),this.setElement(this.groupNo)),this.groupNo.html(this.tmplSys(e)),this.bindDrop();break;default:e.groupId?this.$el.html(this.tmpl(e)):this.$el.html(this.tmplAdd(e)),this.editInput=this.$el.find(".edit-text"),this.bindDrop()}return this},nameChange:function(){var e=require("list/p.model").toJSON();e.key==0&&(e.key=""),require("list/all.view").getData(e),this.render()},click:function(e){var t=r(e.target);if(t.closest(".group-edit-del").length||t.closest(".edit-label").length||t.closest(".group-sure-cancel").length)return;var n=this.model.get("groupId");this.setRouter(n)},selected:function(){this.toggleClass("selected",arguments[1])},mouseenter:function(){if(this.model.get("edited"))return;this.model.set("hover",!0)},mouseleave:function(){this.model.set("hover",!1)},hover:function(){this.toggleClass("hover",arguments[1])},edit:function(){this.model.setEdited()},edited:function(){this.toggleClass("edit-status",arguments[1]),!this.model.get("groupId")&&!arguments[1]&&this.model.destroy(),arguments[1]&&this.editInput.focus()},editCancel:function(){this.model.set("edited",!1)},editOnEnter:function(e){e.keyCode==13&&this.editSure()},editSure:function(){this.model.save({groupName:r.trim(this.editInput.val()),edited:!1},{wait:!0,url:i+"/pim/contact/group/"+(this.model.get("groupId")?"modify":"add")+"_group_json.jsp"})},del:function(){var e=this,t="",n="confirm-warn",i='<div class="dialog-del-status"><h2>确定要删除该分组？</h2><p>（删除分组不会删除该分组下的联系人。）</p></div>';require(["dialog"],function(s){s.confirm(t,i,n,r.proxy(e,"_del"))})},_del:function(){this.model.destroy({wait:!0,url:i+"/pim/contact/group/delete_group_json.jsp"})},delBack:function(){this.remove(),this.model.get("selected")&&this.setRouter(-1)},toggleClass:function(e,t){this.$el.toggleClass(e,!!t)},setRouter:function(e){require(["list/p.model"],function(t){t.set({groupId:e,now:new Date})})},bindDrop:function(){var e=this;this.$el.droppable({accept:"tr",addClasses:!1,hoverClass:"group-highlight",tolerance:"pointer",drop:function(t,n){var r=e.model.id;ids=n.helper.data("ids"),_v=n.helper.data("view"),params={ids:ids};if(_v=="contacts"){if(r!="0")params.groupIds=r;else{var i=require("group/collection").pluck("groupId");i.splice(0,1),i.splice(i.length-1,1),params.delGroupIds=i.join()}require(["groupManage/view"],function(e){e.drag(params)})}else params.groupId=r,require(["groupManage/view"],function(e){e.recycleDrag(params)})}})}});return s}),define("group/collection",["backbone","g","group/model"],function(e,t,n){var r=e.Collection.extend({model:n,url:t.contextPath+"/pim/contact/group/all_group_json.jsp",parse:function(e){if(e.result=="0")return e.info.groups}});return new r}),define("group/collection.view",["backbone","g","group/model.view","group/collection"],function(e,t,n,r){var i=e.$,s=e.View.extend({el:"#groupList",initialize:function(){this.collection=r,this.listenTo(this.collection,"reset",this.addCollection),this.collection.reset(t.groups),this.listenTo(this.collection,"add",this.addModel)},addCollection:function(e,t){var n=document.createDocumentFragment(),r=this;e.each(function(e){var t=e.toJSON(),i=r.initModelView(e);t.groupId!=0&&t.groupId!=-1&&n.appendChild(i.el)}),this.$el.html("").append(n),loadTime.loadFZ=(new Date).getTime();var i=this.currentSelectedGroupId||-1,s=e.get(i);s&&s.set("selected",!0),require(["group/view"],function(e){e.scrollBarManage()})},addModel:function(e){var t=this.initModelView(e);this.$el.append(t.el);var n=require("group/view");n.scrollBarManage()},initModelView:function(e){var t=new n({model:e});return t.render()},ajaxReset:function(e){this.currentSelectedGroupId=e,this.collection.fetch({reset:!0})}});return s}),define("group/view",["backbone","group/model","group/collection.view"],function(e,t,n){var r=e.$,i=e.View.extend({el:"#subMenu",events:{"click #groupAdd":"add","click .scroll-top":"toTop","click .scroll-bottom":"toBottom","mouseenter .scroll-top":"moveTop","mouseenter .scroll-bottom":"moveBottom","mouseleave .scroll-top,.scroll-bottom":"moveStop","click #recycleLi":"openRecycle"},initialize:function(){this.collectionView=new n,this.window=r(window),this.winHeight=this.window.height(),this.groupBox=r("#groupBox"),this.groupBoxOffsetTop=this.groupBox.offset().top,this.groupList=r("#groupList"),this.groupNoHeight=r("#groupNo").height(),this.scrollBox=this.groupBox.find(".group-scroll-box"),this.scrollBar=this.groupBox.find(".scroll-top,.scroll-bottom"),this.otherGroupBox=r("#otherGroupBox"),this.otherGroupBoxHeight=this.otherGroupBox.outerHeight(!0),this.groupBoxHeightManage(),this.groupAdd=r("#groupAdd"),this.recycle=r("#recycleLi"),this.window.resize(r.proxy(this,"windowResize"))},add:function(){var e=new t({groupName:""});this.collectionView.collection.add(e),e.setEdited(),this.scrollBarManage(),this.toBottom()},windowResize:function(){this.winHeight=this.window.height(),this.groupBoxHeightManage(),this.scrollBarManage()},groupBoxHeightManage:function(){this.groupBoxHeight=this.winHeight-this.otherGroupBoxHeight-this.groupBoxOffsetTop,this.groupBox.height(this.groupBoxHeight)},scrollBarManage:function(){this.groupListHeight=this.groupList.outerHeight(!0),this.groupListHeight+this.groupNoHeight>this.groupBoxHeight?this.scrollBar.show():this.scrollBar.hide()},toTop:function(){this.scroll(0)},toBottom:function(){this.scroll(this.groupListHeight)},scroll:function(e){this.scrollBox.stop(!0).animate({scrollTop:e},500)},moveTop:function(){this.move("-=2px")},moveBottom:function(){this.move("+=2px")},move:function(e){var t=this;this.scrollBox.animate({scrollTop:e},100,function(){t.move(e)})},moveStop:function(){this.scrollBox.stop(!0)},resetClickStatus:function(){var e=this.collectionView.collection.findWhere({selected:!0}),t=this.collectionView.collection.findWhere({edited:!0});e&&e.set("selected",!1),t&&t.set("edited",!1),this.recycle.removeClass("selected")},openRecycle:function(){require(["router"],function(e){e.navigate("recycle/1/50/0",{trigger:!0})})},selRecycle:function(){this.resetClickStatus(),this.recycle.addClass("selected")}});return new i}),define("text!list/model.tmpl.html",[],function(){return'<td class="o-h"><i class="i-icons icon-drag"></i></td>\r\n<td><i class="icons icon-check"></i></td>\r\n{{#with vcard}}\r\n<td>\r\n	<span name="contact_list_edit_avatar" class="list-avatar-box edit-able">\r\n		{{#if X-MPS-PHOTO}}\r\n			<img data-original="../pim/contact/avatar.jsp?width=96&height=96&photoid={{X-MPS-PHOTO.0.VALUE}}" class="list-avatar" />\r\n			<span class="avatar-tips">删/改</span>\r\n		{{else}}\r\n			<span class="avatar-tips">添加</span>\r\n		{{/if}}\r\n		<span class="avatar-mask"></span>\r\n	</span>\r\n</td>\r\n<td>\r\n	<a name="contact_Detail" class="logClass view" href="#edit/{{../groupId}}/{{../dataid}}">\r\n	{{#c_n_key N}}\r\n		{{VALUE}}\r\n	{{/c_n_key}}\r\n	</a>\r\n</td>\r\n{{#tagList ../colList ../taglist}}{{VALUE}}{{/tagList}}\r\n{{/with}}'}),define("list/model.tmpl.helper",["jquery","handlebars","common","text!list/model.tmpl.html"],function(e,t,n,r){function u(t,r){if(t===undefined)return"<td>&nbsp;</td>";var i="",s=[],u="",a=o;t.length>1&&e.each(t,function(e,t){t.PFEF?(i=r.fn(t),t.REGION&&(u='<span class="tel-area">'+t.REGION+"</span>")):s.push((a[t.TYPE]||t["X-CUSTOM"]||"电话号码")+"："+r.fn(t))}),i===""&&(s.splice(0,1),i=r.fn(t[0]),t[0].REGION&&(u='<span class="tel-area">'+t[0].REGION+"</span>")),s.length?s='<i class="icons icon-more-tel" tool-tips="'+s.join("\n")+'"></i>':s="";var f=c();return f&&(i=n.wrapSearchKey(i,f)),'<td><span class="no-drag">'+i+"</span>"+u+s+"</td>"}function a(t,r,i){var s=t[r];if(!s)return"<td>&nbsp;</td>";var o=i.fn(s[0]),u="",a="";r==="ORG"&&(o=o.replace(/\\;/g,"[:]").replace(/;/g,"").replace(/\[:\]/g,";")),s.length>1&&(e.each(s,function(e,t){e>0&&(u+=i.fn(t).replace(/\\;/g,"[:]").replace(/;/g,"").replace(/\[:\]/g,";")+"\n")}),a='<i class="icons icon-more-tel" tool-tips="'+u+'"></i>');var f=c();return f&&(o=n.wrapSearchKey(o,f)),'<td><span class="no-drag">'+o+"</span>"+a+"</td>"}function f(t,r,i,s){var o=t[r];if(!o)return"<td>&nbsp;</td>";var u=s.fn(o[0]).replace(/\\;/g,"[:]").replace(/;/g,"").replace(/\[:\]/g,";"),a="",f="",l="";o.length>1&&(e.each(o,function(e,t){if(e>0){var n="";switch(t.TYPE){case"HOME":n="家庭"+i+"：";break;case"WORK":n="办公"+i+"：";break;default:n=i+"："}a+=n+s.fn(t).replace(/\\;/g,"[:]").replace(/;/g,"").replace(/\[:\]/g,";")+"\n"}}),f='<i class="icons icon-more-tel" tool-tips="'+a+'"></i>');var h=c();return h&&(u=n.wrapSearchKey(u,h)),'<td><span class="no-drag">'+u+"</span>"+f+"</td>"}function l(t){var r="",i=n;return e.each(t,function(e,t){r+='<span class="g-i">'+i.htmlEncode(t.groupName)+"</span> "}),r!==""&&(r='<div class="c-g-b">'+r+"</div>"),'<td class="col7">'+(r||"&nbsp;")+"</td>"}function c(){return require("list/collection.view").getKey()}var i,s=Handlebars.compile(r);Handlebars.registerHelper("c_n_key",function(t,r){var i="";if(t){i=r.fn(t[0]).replace(/\\;/g,"[:]").replace(/;/g,"").replace(/\[:\]/g,";");var s=c();s&&(i=n.wrapSearchKey(i,s))}return e.trim(i)||"未命名"}),Handlebars.registerHelper("c_n",function(t,n){var r="";return t&&(r=n.fn(t[0]).replace(/\\;/g,"[:]").replace(/;/g,"").replace(/\[:\]/g,";")),e.trim(r)||"未命名"}),Handlebars.registerHelper("tagList",function(t,n,r){if(t==="")return"<td>&nbsp;</td>";var i=t.split(","),s=this,o="";return e.each(i,function(e,t){switch(t){case"tel":o+=u(s.TEL,r);break;case"qq":o+=a(s,"X-TC-dwQQ",r);break;case"adr":o+=f(s,"ADR","地址",r);break;case"group":o+=l(n);break;case"note":o+=a(s,"NOTE",r);break;case"url":o+=f(s,"URL","网址",r);break;case"birthday":o+=a(s,"BDAY",r);break;case"email":o+=f(s,"EMAIL","邮箱",r);break;case"job":o+=a(s,"TITLE",r);break;case"org":o+=a(s,"ORG",r)}}),o});var o={CELL:"常用手机",CELL_HOME:"常用家庭手机",CELL_WORK:"常用办公手机",HOME:"家庭电话",WORK:"办公电话",FAX:"传真",FAX_HOME:"家庭传真",FAX_WORK:"办公传真"};return s}),define("list/model.view",["backbone","list/model.tmpl.helper","common"],function(e,t,n){var r=e.$,i=e.View.extend({tmpl:t,tagName:"tr",events:{click:"click","mouseenter .edit-able":"avatarHover","mouseleave .edit-able":"avatarLeave","click .edit-able":"uploadAvatar"},initialize:function(){this.listenTo(this.model,"change:selected",this.selected)},render:function(){var e=this.model.toJSON();return this.$el.html(this.tmpl(e)).attr("dataid",e.dataid),this.bindDrag(),this},click:function(e){if(e.target.tagName.toLowerCase()==="a")return;var t=!!this.model.get("selected");this.model.set("selected",!t),n.logSubmit(e,"contact_select")},selected:function(e,t){this.$el.toggleClass("selected",t);var n=this.getSelected().length,r=require("list/head.view"),i=require("list/all.view").model.get("recordCount"),s=n?n==i?"all":"mix":"none";r.setCheckboxType(s)},avatarHover:function(e){var t=r(e.currentTarget),n=t.find("img");n.length?this.showBigAvatar(t,n):this.showEditTips(t)},showBigAvatar:function(e,t){var n=t.attr("src"),i=n.replace(/=96/g,"=256"),s=e.offset(),o=r("#avatarBox");o.length||(o=r('<div id="avatarBox">'),r("body").append(o)),e.find(".avatar-mask,.avatar-tips").show(),o.html("").append(t.clone());var u=new Image;r(u).load(function(){o.html("").append(u)}),u.src=i,o.is(":visible")?o.stop(!0,!0).animate({top:s.top-64},500).fadeIn(200):o.css({left:s.left+36,top:s.top-64}).delay(100).fadeIn(200)},avatarLeave:function(e){var t=r(e.currentTarget);t.find(".avatar-mask,.avatar-tips").hide(),r("#avatarBox").stop(!0,!0).delay(500).fadeOut(200)},showEditTips:function(e){e.find(".avatar-mask,.avatar-tips").show()},bindDrag:function(){var e=this;this.$el.draggable({revert:"invalid",revertDuration:200,cursorAt:{top:5,left:5},handle:".o-h",addClasses:!1,appendTo:"body",containment:"body",helper:function(t){e.model.set("selected",!0);var i=e.getSelected(),s=e.getIds(i),o=i.length;return n.logSubmit(t,"list_drag"),r('<div class="drag-move-helper">正拖动 '+o+" 个联系人</div>").data({ids:s.join(),view:"contacts"})}})},getSelected:function(){return require("list/collection").getSelected()},getIds:function(e){var t=[];return r.each(e,function(e,n){t[e]=n.toJSON().dataid}),t},uploadAvatar:function(){var e=this.model.get("vcard"),t={photoid:"",dataid:this.model.get("dataid")},n={upload:r.proxy(this,"uploadBack")};e&&e["X-MPS-PHOTO"]&&(t.photoid=e["X-MPS-PHOTO"][0].VALUE,n.del=r.proxy(this,"delBack")),require(["avatar/view"],function(e){e.open(t,n)})},uploadBack:function(e){var t=e.photoid,n=this.model.toJSON();n.vcard["X-MPS-PHOTO"]?n.vcard["X-MPS-PHOTO"][0].VALUE=t:(n.vcard["X-MPS-PHOTO"]=[{VALUE:t}],r('<img class="list-avatar">').appendTo(this.$el.find(".list-avatar-box"))),this.model.set(n),this.$el.find("img.list-avatar").attr("src","../pim/contact/avatar.jsp?width=96&height=96&photoid="+t)},delBack:function(){var e=this.model.get("vcard");delete e["X-MPS-PHOTO"],this.model.set("vcard",e),this.render()}});return i}),define("list/model",["backbone"],function(e){var t=e.Model.extend({idAttribute:"dataid",parse:function(e){return e.result!==undefined?e.result==="0"?e.info||{}:{result:e.msg}:e}});return t}),define("list/collection",["backbone","list/model"],function(e,t){var n=e.Collection.extend({model:t,parse:function(e){if(e.result=="0")return e.info.vacrds},getSelected:function(){return this.where({selected:!0})}});return new n}),define("list/collection.view",["backbone","list/model.view","list/collection","common"],function(e,t,n,r){var i=require("g"),s=e.$,o=e.View.extend({el:"#contactsBody",initialize:function(){this.collection=n,this.listenTo(this.collection,"reset",this.addCollection)},setData:function(e,t){this.colList=t;var n=require("list/p.model"),r=n.get("key");this.setKey(r),e.length?this.collection.reset(e):(this.collection.reset([],{silent:!0}),this.firstLoad!==!0&&(this.createBlank(),this.firstLoad=!0,loadTime.loadLB=(new Date).getTime(),i.cesu()))},createBlank:function(){var e=require("list/p.model"),t=e.get("groupId"),n=e.get("key"),r='<tr class="tr-no-content"><td class="no-line no-drag" colspan="4"><div class="group-no-contact"></div></td></tr>';if(n=="0")t=="-1"&&(r='<tr class="tr-no-content"><td colspan="4" class="no-line no-drag"><div class="no-import"><a href="http://pim.qq.com/down.jsp" target="_blank" class="tip-down"></a><p>（请进 <a href="http://pim.qq.com/" target="_blank">pim.qq.com</a> 下载安装手机应用）</p></div></td></tr>');else{var i=require("group/collection"),s=i.get(t).get("dataListSize");if(s!=0){var o=e.toJSON(),u="#list/"+o.groupId+"/"+o.pageNo+"/"+o.pageSize+"/"+o.order+"/"+o.sortBy+"/0";r='<tr class="tr-no-content"><td class="no-line no-drag" colspan="4"><div class="search-no-content">很努力地找过了，确实没有相关联系人记录。<a href="#'+u+'" class="clear-search-key">清空搜索条件</a></div></td></tr>'}}this.$el.html(r)},addCollection:function(e){var t=require("list/p.model"),n=document.createDocumentFragment(),r=this,s=t.get("groupId");e.each(function(e){e.set("colList",r.colList),e.set("groupId",s);var t=r.initModelView(e);n.appendChild(t.el)}),this.$el.html("").append(n),this.firstLoad!==!0&&(this.firstLoad=!0,loadTime.loadLB=(new Date).getTime(),setTimeout(function(){i.cesu()},100)),setTimeout(function(){r.bindLazyLoad(),r.bindSelect()},10)},initModelView:function(e){var n=new t({model:e});return n.render()},bindSelect:function(){var e=0;if(s.browser.msie&&s.browser.version==7||document.documentMode&&document.documentMode==7)e=1;var t=this;this.$el.selectable({filter:"tr",delay:e,distance:1,selecting:function(e,n){var r=s(n.selecting),i=r.attr("dataid");t.collection.get(i).set("selected",!r.is(".selected"))},stop:function(e,t){r.logSubmit(e,"list_select")}})},bindLazyLoad:function(){this.$el.find("img.list-avatar").lazyload({effect:"fadeIn",container:"#contactsListBox"})},setKey:function(e){if(e==="0"||/^PINYIN/.test(e))e="";this.key=e},getKey:function(){return this.key}});return new o}),define("text!list/head.tmpl.html",[],function(){return'<tr>\r\n	<th class="col1">&nbsp;</th>\r\n	<th class="col2"><i name="contact_chk_all" class="icons icon-check logClass" ></i></th>\r\n	<th class="col3"><i class="icons icon-avatar"></i></th>\r\n	<th class="col4"><a href="javascript:void(0)" id="sortByName" class="sort-item">姓名 <i class="icons icon-sort-az"></i> <i class="icons icon-arrow-hot"></i></a></th>\r\n	{{#each this}}\r\n	<th>{{value}}</th>	\r\n	{{/each}}\r\n</tr>'}),define("list/head.view",["backbone","text!list/head.tmpl.html","handlebars"],function(e,t){var n=require("underscore"),r=Handlebars.compile(t),i=e.Model.extend({defaults:{}}),s=e.View.extend({el:"#contactsHead",tmpl:r,tagName:"tr",events:{"click .icon-check":"checkboxClick","click .sort-item":"sort"},headConfig:{tel:"电话",qq:"QQ号",group:"组",adr:"地址",email:"邮箱",birthday:"生日",job:"职位/院系",org:"公司/部门/学校",url:"网址",note:"备注"},initialize:function(){this.model=new i,this.listenTo(this.model,"change",this.render),this.checkModel=new i({type:"none"}),this.listenTo(this.checkModel,"change:type",this.checkChange)},render:function(){var e=this.model.toJSON();return this.$el.html(this.tmpl(e)),this},setData:function(e){var t={},r=e.split(","),i=0,s=r.length;for(;i<s;i++)t[r[i]]={value:this.headConfig[r[i]]};s===0&&(t.no={value:" "});if(n.isEqual(t,this.model.toJSON())){this.setCheckboxType("type","none");return}this.model.clear({silent:!0}),this.model.set(t),this.setSortClassName()},checkboxClick:function(){var e=this.checkModel.get("type"),t=e==="all"?"none":"all";this.checkModel.set("type",t);var r=require("list/collection.view").collection.models,i=t=="all";n.each(r,function(e){e.set("selected",i)})},setCheckboxType:function(e){this.checkModel.set({type:e})},checkChange:function(e,t){var n="",r=this.$el.find(".icon-check").removeClass("icon-check-mixed").removeClass("icon-checked");switch(t){case"mix":n="icon-check-mixed";break;case"all":n="icon-checked"}this.$el.find(".icon-check").addClass(n)},setSortClassName:function(){require(["list/p.model"],function(e){var t=e.toJSON(),n;t.sortBy=="name"?n=t.order=="ASC"?"az":"za":n=t.order=="ASC"?"on":"no",$("#sortByName").children("i:first").attr("class","icons icon-sort-"+n)})},sort:function(e){new o}});$(".i-sz").on("click",function(e){var t=$(e.currentTarget);t.selector=".i-sz",require(["list/site"],function(e){e.show(t)})});var o=e.View.extend({el:"#contactSortDiv",events:{"click a":"click"},initialize:function(e){this.body=$("body"),this.targetBtn=$("#sortByName"),this.targetBtn.addClass("sort-current"),this.$el.show(),this.body.bind("click.sortroped",$.proxy(this,"_docClick"))},click:function(e){var t=$(e.currentTarget),n=t.attr("name").split("_"),r=t.children("i").attr("class").replace("-g","");this.setTargetClass(r),require("list/p.model").set({pageNo:"1",order:n[1],sortBy:n[0]}),this.$el.hide(),this.body.unbind("click.sortroped"),this.targetBtn.removeClass("sort-current")},setTargetClass:function(e){this.targetBtn.children("i:first").attr("class",e)},hide:function(){this.$el.hide(),this.body.unbind("click.sortroped"),this.targetBtn.removeClass("sort-current")},_docClick:function(e){var t=$(e.target);t.closest(this.targetBtn.selector).length||this.hide()}});return new s}),define("combobox",["jquery"],function(e){var t="click",n=".combobox",r="cbb-dropdown",i=null;return{add:function(){var e={},r=arguments[0],i,s;if(arguments.length==1)for(i in r)s=r[i],e.event=s.event||t,e.selector=s.selector||n,this.bindEvent(e),this.setOptions(i,s.options),this.setHandle(i,s.handle),this.setTarget(i,e.selector),this.setRelated(i,s.related),this.setCbbDropedClass(i,s.dropedClass),this.setCbbHoverClass(i,s.hoverClass);else if(arguments.length==2){e.event=r.event||t,e.selector=r.selector||n,this.bindEvent(e);for(i in arguments[1])s=arguments[1][i],this.setOptions(i,s.options||r.options),this.setHandle(i,s.handle||r.handle),this.setTarget(i,e.selector),this.setRelated(i,r.related),this.setCbbDropedClass(i,r.dropedClass),this.setCbbHoverClass(i,r.hoverClass)}},bindEvent:function(t){var n=this;e("body").delegate(t.selector,t.event,e.proxy(this,"handle")).delegate(t.selector,{hover:function(){var t=e(this),r=n.getCbbHoverClass(t.attr("name"));if(!r)return;t.toggleClass(r)},mouseenter:e.proxy(this,"mouseenter"),mouseleave:e.proxy(this,"mouseleave")})},setOptions:function(e,t){this.options||(this.options={}),this.options[e]=t},getOptions:function(e){return this.options[e]},setHandle:function(e,t){this.handle||(this.handle={}),this.handle[e]=t},getHandle:function(e){return this.handle[e]},setTarget:function(e,t){this.target||(this.target={}),this.target[e]=t},getTarget:function(e){return this.target[e]},setRelated:function(e,t){this.related||(this.related={}),this.related[e]=t},getRelated:function(e){return this.related[e]},setCurName:function(e){this.curName=e},getCurName:function(){return this.curName},setCbbDropedClass:function(e,t){this.dropedClass||(this.dropedClass={}),this.dropedClass[e]=t},getCbbDropedClass:function(e){return this.dropedClass[e]},setCbbHoverClass:function(e,t){this.hoverClass||(this.hoverClass={}),this.hoverClass[e]=t},getCbbHoverClass:function(e){return this.hoverClass[e]},setCbbClass:function(e){var t=this.getCbbDropedClass(e);this.currentCbb.addClass(t)},removeCbbClass:function(e){var t=this.getCbbDropedClass(e);if(!t)return;this.currentCbb.removeClass(t)},handle:function(t){var n=e(t.currentTarget),r=n.attr("name"),s=e(this.getRelated(r));if(s.is(":visible")&&n.is(this.currentCbb))return;this.hide(),this.currentCbb=n,this.currentCbbText=this.currentCbb.children(":text").blur(),clearTimeout(i),this.createContainer(r),this.setCbbClass(r),this.show(n)},createContainer:function(t){var n=e(this.getRelated(t));n.length||(n=e("<ul />").attr("id",this.getRelated(t).substring(1)).addClass(r),n.appendTo("body").delegate("li","click",e.proxy(this,"click")).delegate("li","hover",e.proxy(this,"hover")).bind("mouseenter",e.proxy(this,"mouseenter")).bind("mouseleave",e.proxy(this,"mouseleave"))),n.attr("name",t),this.setCurName(t),e.fn.bgiframe&&n.bgiframe();var i=this.getOptions(t),s=this.currentCbbText.val(),o="",u="";for(var a=0,f=i.length;a<f;a++)s!=i[a].text?o="":o='class="selected"',u+="<li "+o+' value="'+i[a].value+'">'+i[a].text+"</li>";n.hide().html(u),this.optionsContainer=n},show:function(t){var n=t.offset(),r=t.outerHeight(),i=t.outerWidth();this.optionsContainer.width(i-2);var s=n.top+r,o=this.optionsContainer.outerHeight();s+o>e(document).height()?s=n.top-o+1:s-=1;var u={left:n.left,top:s};this.optionsContainer.css(u).slideDown(100)},hide:function(){this.optionsContainer&&(this.optionsContainer.hide(),this.removeCbbClass(this.getCurName()))},mouseleave:function(t){if(this.chkRelated(e(t.relatedTarget)))return;clearTimeout(i),i=setTimeout(e.proxy(this,"hide"),500)},mouseenter:function(t){if(!this.chkRelated(e(t.relatedTarget)))return;clearTimeout(i)},chkRelated:function(e){var t=this.getCurName(),n=e.closest(this.getTarget(t));return e.closest(this.getRelated(t)).length||e.closest(this.getTarget(t)).is(this.currentCbb)?!0:!1},click:function(t){var n=e(t.currentTarget),r=n[0].getAttribute("value"),i=n.text(),s=this.getHandle(this.getCurName());this.update(i),s&&s(r),this.hide()},hover:function(t){var n=e(t.currentTarget);n.toggleClass("hover")},update:function(e){if(!this.currentCbbText)return;this.currentCbbText.val(e)}}}),define("text!list/page.tmpl.html",[],function(){return'<div class="page-bar-innerbox">\r\n	<div class="page-size-select">\r\n		每页显示\r\n		<span name="page_size" class="cbb-page-size">\r\n			<input type="text" readonly="readonly" style="width: 26px;" class="cbb-text" value="{{pageSize}}" />\r\n			<i class="icons icon-arrow-light"></i>\r\n		</span>\r\n		条\r\n	</div>\r\n	<div class="page page-contact">\r\n		{{#if fc }}\r\n		<a class="icons icon-page-first" href="#" title="第一页"></a>\r\n		<a class="icons icon-page-prev" href="#" title="上一页"></a>\r\n		{{else}}\r\n		<i class="icons icon-page-first"></i>\r\n		<i class="icons icon-page-prev"></i>\r\n		{{/if}}\r\n		<span class="page-textarea">\r\n			第<input type="text" value="{{pageNo}}" class="text" title="按回车键跳转" />/{{pageCount }}页\r\n		</span>\r\n		{{#if lc }}\r\n		<a class="icons icon-page-next" href="#" title="下一页"></a>\r\n		<a class="icons icon-page-last" href="#" title="最后一页"></a>\r\n		{{else}}\r\n		<i class="icons icon-page-next"></i>\r\n		<i class="icons icon-page-last"></i>\r\n		{{/if}}\r\n	</div>\r\n</div>'}),define("list/page.view",["backbone","combobox","text!list/page.tmpl.html","handlebars"],function(e,t,n){var r=require("underscore"),i=Handlebars.compile(n),s=e.Model.extend({defaults:{pageNo:0,pageCount:0,pageSize:0,total:0}}),o=e.View.extend({tmpl:i,events:{"click a":"click","keypress .text":"keypress","keyup .text":"keyup","click .cbb-page-size":"pageSizeClick"},pModel:"list/p.model",pageSize:"page_size",initialize:function(){this.model=new s,this.listenTo(this.model,"change",this.render)},render:function(){var e=this.dealData(this.model.toJSON());return e.total<50?(this.$el.hide(),this):(this.$el.html(this.tmpl(e)).show(),this.$el.find(".cbb-page-size").attr("name",this.pageSize),this)},setData:function(e){this.model.set(e)},dealData:function(e){return e.fc=!(e.pageNo<=1),e.lc=!(e.pageNo>=e.pageCount),e},click:function(e){e.preventDefault();var t=$(e.target),n=t.attr("class").replace("icons ",""),r=this.model.get("pageNo");switch(n){case"icon-page-next":r++;break;case"icon-page-prev":r--;break;case"icon-page-first":r=1;break;case"icon-page-last":r=this.model.get("pageCount")}this.jump({pageNo:r})},jump:function(e){var t=e.pageNo,n;t&&(n=this.model.get("pageCount"),t>n?t=n:t<1&&(t=1),e.pageNo=t+""),require([this.pModel],function(t){t.set(e)})},keypress:function(e){!/^\d+$/.test(String.fromCharCode(e.charCode))&&e.charCode>9&&!e.ctrlKey&&e.preventDefault()},keyup:function(e){if(e.keyCode==13){var t=$(e.target),n=parseInt(t.val(),10);isNaN(n)&&(n=1),this.jump({pageNo:n})}},setPageSize:function(){var e={};e[this.pageSize]={options:[{value:50,text:50},{value:100,text:100},{value:150,text:150},{value:200,text:200}],event:"click",selector:".cbb-page-size",related:"#cbbpsDropdown",dropedClass:"cbb-droped",hoverClass:"cbb-page-hover",handle:$.proxy(this,"pageSizeChange")},t.add(e),this.pageSizeIsInit=!0},pageSizeChange:function(e){require([this.pModel],function(t){t.set({pageSize:e,pageNo:"1"})})},pageSizeClick:function(e){this.pageSizeIsInit||this.setPageSize()}});return o}),define("list/all.view",["backbone","list/collection.view","list/head.view","list/page.view","common"],function(e,t,n,r,i){var s=require("g"),o=e.$,u=e.Model.extend({parse:function(e){if(!i.resolveResult(e.result,e.msg))return{};if(e.result=="0")return e.info.recordCount==0&&t.createBlank(),e.info}}),a=e.View.extend({el:"#contactsListBox",initialize:function(){var e=this;this.model=new u,this.window=o(window),this.listenTo(this.model,"change",this.render),this.collectionView=t,this.headView=n,this.pageView=new r({el:"#contactsPage"}),this.window.resize(o.proxy(this,"windowResize"))},getData:function(e){i.showModule("#contactsList"),this.listHeightManage();if(!this.isFirstLoad){this.isFirstLoad=!0;if(e.groupId=="-1"&&e.key==""&&e.order=="ASC"&&e.pageNo=="1"&&e.pageSize=="50"&&e.sortBy=="name"){this.model.set(s.contacts);return}}this.model.fetch({url:s.contextPath+"/pim/contact/card/search_by_key_json.jsp",data:e})},render:function(e){var t=e.toJSON();this.collectionView.setData(t.vacrds,t.showTagList),this.headView.setData(t.showTagList),this.pageView.setData({pageNo:t.pageNo,pageSize:t.pageSize,pageCount:t.pageCount,total:t.totalRecordCount});var n=t.totalRecordCount,r=e.previous("totalRecordCount");(!r||n<50&&r>50||n>50&&r<50)&&this.listHeightManage()},windowResize:function(){this.listHeightManage()},listHeightManage:function(){if(this.$el.is(":hidden"))return;var e=this.model.get("totalRecordCount"),t=this.$el.offset().top,n=e>50?this.pageView.$el.offset().top:this.window.height();this.$el.height(n-t)}});return new a}),define("list/p.model",["backbone","common"],function(e,t){var n=e.Model.extend({defaults:{groupId:-1,key:"0",order:"ASC",pageNo:"1",pageSize:"50",sortBy:"name"},initialize:function(){this.on("change",this.change)},change:function(e){this.parse();var t=this.toJSON(),n=["list",t.groupId,t.pageNo,t.pageSize,t.order,t.sortBy,encodeURIComponent(t.key)].join("/");require(["router"],function(e){e.navigate(n,{trigger:!0})})},parse:function(){var e=this.toJSON(),n=_.clone(e);e.groupId<-1&&(n.groupId="-1");var r="0";e.key===""||e.key=="null"||e.key==undefined||t.getStrLen(e.key)<2?n.key="0":(r=e.key,/PINYIN:/.test(r)&&(/^PINYIN:[A-Z#]$/.test(r)?r=r.substr(7,1):r="0")),require(["list/filters","list/search"],function(e,t){e.model.set("key",r),t.model.set("key",r)}),e.pageNo<0&&(n.pageNo="1"),e.pageSize<0&&(n.pageSize="50"),e.order!="ASC"&&e.order!="DESC"&&(n.order="ASC"),e.sortBy!="name"&&e.sortBy!="time"&&(n.sortBy="name"),_.isEqual(e,n)?this.legality=!0:(this.legality=!1,this.set(n,{silent:!0}))}});return new n}),define("list/filters",["backbone","g"],function(e,t){var n=e.$,r=t.filters,i=e.Model.extend({defaults:{key:"0"}}),s=e.View.extend({el:"#filters",events:{"click a":"click"},initialize:function(){this.model=new i,this.listenTo(this.model,"change",this.change),this.render()},render:function(){var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],t=this,r=[],i='<td class="first"><a href="#" class="selected">全部</a></td>';n.each(e,function(e,n){r[e]="<td>",t.contains(n)?r[e]+='<a href="#">'+n+"</a>":r[e]+="<span>"+n+"</span>",r[e]+="</td>"}),r.length||(i='<td class="first"><span>全部</span></td>'),this.$el.html(i+r.join(""))},click:function(e){e.preventDefault();var t=n(e.currentTarget),r=t.text();r=="全部"&&(r="0");if(t.is(".selected"))return;this.model.set("key",r)},contains:function(e){var t=!1;return n.each(r,function(n,r){if(e==r)return t=!0,!1}),t},clearSelected:function(){this.$el.find(".selected").removeClass("selected")},change:function(){this.clearSelected();var e=this.model.get("key");if(!/^[A-Z#0]$/.test(e))e="0",this.model.set({key:e},{silent:!0});else{var t=e=="0"?"0":"PINYIN:"+e;require(["list/p.model"],function(e){e.set({key:t,pageNo:"1"})})}e=="0"&&(e="全部"),this.$el.find(":contains("+e+")").addClass("selected")}});return new s}),define("list/search",["backbone","common"],function(e,t){var n=e.Model.extend({defaults:{key:""}}),r=e.View.extend({el:"#contactsListBtnbar",events:{"keyup .search-text":"search"},initialize:function(){this.model=new n,this.listenTo(this.model,"change:key",this.change);var e=this},change:function(e,t){/^[A-Z#0]$/.test(t)?(t="",this.model.set({key:t},{silent:!0})):require("list/p.model").set({key:t,pageNo:"1"}),this.$el.find(".search-text").val(t)},search:function(e){clearTimeout(this.searchTimer);var n=$.trim(e.target.value),r=t.getStrLen(n),i=this.model.previous("key");if(!i&&r<2||i==n)return;n=n.replace(/\'/g,"");var s=this;this.searchTimer=setTimeout(function(){s.model.set("key",n)},300)}});return new r}),define("list/btnbar",["backbone","list/search","g","common"],function(e,t,n,r){var i=e.$,s=n.contextPath,o=e.View.extend({el:"#contactsListBtnbar",events:{"click [name=del_sel_contact]":"del","click [name=del_contact_by_group]":"delAll","click [name=group_manage_list]":"groupManage","click [name=more_manage]":"moreManage"},initialize:function(){},del:function(){var e=this,t=this.getSelected();if(!t.length)return r.ajaxTips("请选择要删除的联系人");require(["dialog"],function(n){var r="",i="confirm-warn",s='<div class="dialog-del-status"><h2>确认要删除选中的<b>'+t.length+"</b>个联系人？</h2>"+"<p>（联系人会在通讯录中删除并移至回收站。）</p>"+"</div>";n.confirm(r,s,i,function(){e._del(t)})})},_del:function(e){var t=[];i.each(e,function(e,n){t[e]=n.toJSON().dataid}),i.ajax({url:s+"/pim/contact/card/delete_card_json.jsp",data:{ids:t.join()},success:function(e){if(!r.resolveResult(e.result,e.msg))return;r.ajaxTips(e.msg);var e=require("list/p.model").toJSON();require("group/view").collectionView.ajaxReset(e.groupId),e.key==0&&(e.key=""),require("list/all.view").getData(e)}})},delAll:function(){if(!this.getCollection().length)return r.ajaxTips("该分组没有联系人");var e=this;require(["dialog"],function(t){var n="",r="confirm-warn",s='<div class="dialog-del-status"><h2>确认要删除当前分组的所有联系人？</h2><p>（联系人会在通讯录中删除并移至回收站。）</p></div>';t.confirm(n,s,r,i.proxy(e,"_delAll"))})},_delAll:function(){var e=require("list/p.model").get("groupId"),t=this;i.ajax({url:s+"/pim/contact/card/delete_card_by_groupid_json.jsp",data:{groupId:e},success:function(n){if(!r.resolveResult(n.result,n.msg))return;r.ajaxTips(n.msg),require("group/view").collectionView.ajaxReset(e),t.getCollection().reset()}})},getSelected:function(){return this.getCollection().getSelected()},getCollection:function(){return require("list/collection")},groupManage:function(e){var t=i(e.currentTarget),n=this.getSelected();t.selector=".group-manage",n.length?require(["groupManage/view"],function(e){e.show(n,t,{ajax:!0})}):r.ajaxTips("请选择要添加到分组的名片")},moreManage:function(e){var t=i(e.currentTarget),n;this.mm?this.mm.bindBodyClick():this.mm=new u,n=this.mm.$el,t.selector="#moreManageBtn",require(["setPosition"],function(e){e({target:n.show(),btn:t})})}}),u=e.View.extend({el:"#contactMoreManage",events:{"mouseenter a":"mouseenter","mouseleave a":"mouseleave","click a":"hide","click .cleargroup":"cleargroup"},initialize:function(e){this.body=i("body"),this.targetBtn=i("#moreManageBtn"),this.targetBtn.addClass("click"),this.bindBodyClick()},bindBodyClick:function(){this.body.bind("click.Mdroped",i.proxy(this,"_docClick"))},mouseenter:function(e){i(e.target).addClass("hover")},mouseleave:function(e){i(e.target).removeClass("hover")},hide:function(){this.$el.hide(),this.body.unbind("click.Mdroped"),this.targetBtn.removeClass("click")},_docClick:function(e){var t=i(e.target);t.closest(this.targetBtn.selector).length||this.hide()},cleargroup:function(e){e.preventDefault();var t=this,n="",r="confirm-warn",s='<div class="dialog-del-status"><h2>温馨提示</h2><p>删除全部分组信息，联系人不会被删除，会移至未分组内。确定删除？</p></div>';require(["dialog"],function(e){e.confirm(n,s,r,i.proxy(t,"_del"))})},_del:function(){i.ajax({url:s+"/pim/contact/group/delete_group_json.jsp",data:{groupId:-1},success:function(e){if(!r.resolveResult(e.result,e.msg))return;r.ajaxTips(e.msg),require("group/view").collectionView.ajaxReset(-1)}})}});return new o}),loadTime.loadJS2=(new Date).getTime(),require.config({baseUrl:"../src/js/",paths:{jquery:"lib/jquery",md5:"lib/jquery.md5",backbone:"lib/backbone",underscore:"lib/underscore","jquery.ui":"lib/ui/jquery.ui","jquery.migrate":"lib/jquery.migrate",dialog:"lib/dialog.sys",formtips:"lib/formtips",handlebars:"lib/handlebars",text:"lib/text",combobox:"lib/combobox",placeholder:"lib/placeholder",lazyload:"lib/lazyload",tips:"lib/tips",ajaxfileupload:"lib/ajaxfileupload",setPosition:"lib/setPosition",swfupload:"lib/swfupload",webuploader:"lib/webuploader.withoutimage",cookie:"lib/cookie",page:"lib/page",g:"empty:",avatar:"contact/avatar",batch:"contact/batch",chong:"contact/chong",edit:"contact/edit","export":"contact/export",group:"contact/group",groupManage:"contact/groupManage","import":"contact/import",list:"contact/list",merge:"contact/merge",recycle:"contact/recycle",time:"contact/time",router:"contact/router"},shim:{backbone:{deps:["underscore","jquery"],exports:"Backbone"},underscore:{exports:"_"},md5:["jquery"],tips:["jquery"],lazyload:["jquery"],"jquery.migrate":["jquery"],formtips:["jquery.ui"],placeholder:["jquery"],page:["jquery"]}}),require(["g","router","group/view","list/all.view","list/p.model","list/filters","list/btnbar"],function(e){require(["https://ui.ptlogin2.qq.com/js/ptloginout.js"])}),define("main",function(){});